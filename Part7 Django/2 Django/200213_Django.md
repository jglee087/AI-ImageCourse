## Django Intermediate 2



models.py를 수정하고 하면 **반드시** 다음을 실행한다.
python manage.py makemigrations
python manage.py migrate 
python manage.py sqlmigrate ...



작업순서

1. settings.py
2. urls.py
3. 폴더의 urls.py

4. 폴더의 views.py # (UI)

5. models.py - class 생성(주 클래스 1개, 종속 클래스 1개)
6. admin.py



#### \polls\views.py 수정

```python
def detail(request, question_id):
    return HttpResponse("You're looking at question {}.".format(question_id))

def resuls(request, question_id):
    response="You're looking at the result of question {}.".fomrat(question_id)
    return HttpResponse(response.format(question.id))

def vote(request,question_id):
    return HttpResponse("You're voting on question {}.".format(question_id))
```



#### \poll\urls.py 수정

```python
urlpatterns = [
    path('', views.index, name='index'),
    # 127.0.0.1:8000/polls/3/
    path('<int:question_id>/',views.detail,name='detail'),
    # 127.0.0.1:8000/polls/result/
    path('<int:question_id>/result/',views.result,name='result'),
    # 127.0.0.1:8000/polls/vote/
    path('<int:question_id>/vote/',views.vote,name='vote'),
]

```



#### cmd 창으로 이동

```
cd / 
cd work_django
cd django_mldl
cd site_2
```

가상환경 구동!



python manage.py runserver
!! settings.py 에서 Debug = True



http://127.0.0.1:8000/polls/3/ 을 실행하면??
question table의 3번을 출력



#### \polls\views.py 수정

```python
from .models import Question

def index(request):

	latest_question_list = Question.objects.order_by('-pub_date')[:5]
	context = {'latest_question_list': latest_question_list}
	return render(request, 'polls/index.html', context)
```



#### template 파일 만들기

1. polls 폴더 아래에 templates 폴더 만들기 복수형임을 꼭 유의해주세요
2. templates 폴더 아래에 polls 폴더 만들기
3. polls 폴더 안에 index.html 생성 후 내 용 작성



#### polls\templates\polls\index.html

```html
{% if latest_question_list %}
 <ul> #<ol>
  {% for question in latest_question_list %}
    <li>
     <a href="/polls/{{ question.id }}/"> {{ question.question_text }}</a>
    </li>
  {% endfor %}
 </ul> #</ol>
{% else %}
 <p>No polls are available.</p>
{% endif %}
```

`<li>`태그는 줄바꿈.



#### 투표(question) 상세 페이지 template 연동 하기 & 404 에러페이지 다루기

\polls\views.py 파일 수정

```python
def detail(request, question_id):
	q = Question.objects.get(pk=question_id)
	return render(request, 'polls/detail.html',{'question':q})
```



#### polls\templates\polls\detail.html 작성

{{ question }} 한 줄 작성




#### views.py 파일 수정

```python
def detail(request, question_id):
    try:
        q = Question.objects.get(pk=question_id)
    except Question.DoesNotExist:
        raise Http404('Question {} does not exist'.format(question_id))
    return render(request, 'polls/detail.html',{'question':q})

```



#### http://127.0.0.1:8000/polls/20 접속

-> Page not found (404) 페이지 출력



#### views.py 파일 수정 해서 간결하게 404 처리하기

```python
from django.shortcuts import render, get_object_or_404
from django.http import HttpResponse, Http404
from .models import Question

def detail(request, question_idquestion_id):
	q = get_object_or_404(Question,pk=question_id)
	return render(request, 'polls/detail.html',{'question':q})
```



#### polls\urls.py의 url 패턴이 갖고 있는 name 을 활용해 하드코딩된 URL 바꿔주기

```python
app_name='polls' 추가
```



#### polls\templates\polls\index.html 수정

```python
{% if latest_question_list %}
 <ul>
  {% for question in latest_question_list %}
    <li>
     <!-- <a href="/polls/{{ question.id }}/"> {{ question.question_text }}</a> -->
     <a href="{url 'polls:detail' question:id %}"> {{ question.question_text }}</a> 이 줄 수정
    </li>
  {% endfor %}
 </ul>
{% else %}
 <p>No polls are available.</p>
{% endif %}
```

**url reversing(?)**



